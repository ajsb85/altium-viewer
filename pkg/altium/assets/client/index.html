<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-40175800-18"></script>
  <script>window.dataLayer = window.dataLayer || []
    function gtag() {
      dataLayer.push(arguments)
    }
    gtag('js', new Date())
    gtag('config', 'UA-40175800-18', {
      custom_map: {
        dimension1: 'domain',
        dimension2: 'url',
        dimension3: 'env'
      }
    })</script>
  <script defer="defer" src="js/runtime.js?1761730629786"></script>
  <script defer="defer" src="js/vendors.js?1761730629786"></script>
  <script defer="defer" src="js/app.js?1761730629786"></script>
  <link href="js/appStyles.css?1761730629786" rel="stylesheet">
</head>

<body>
  <script>
      // Visual Logger for Debugging
      (function () {
        var logDiv = document.createElement('div');
        logDiv.style.position = 'fixed';
        logDiv.style.top = '0';
        logDiv.style.right = '0';
        logDiv.style.width = '300px';
        logDiv.style.height = '100%';
        logDiv.style.backgroundColor = 'rgba(0,0,0,0.7)';
        logDiv.style.color = 'lime';
        logDiv.style.fontFamily = 'monospace';
        logDiv.style.fontSize = '12px';
        logDiv.style.overflowY = 'scroll';
        logDiv.style.padding = '5px';
        logDiv.style.zIndex = '9999';
        logDiv.style.pointerEvents = 'none'; // click through
        document.addEventListener('DOMContentLoaded', function () { document.body.appendChild(logDiv); });

        function printLog(prefix, args) {
          var msg = prefix + " " + Array.from(args).map(a =>
            (typeof a === 'object' ? JSON.stringify(a) : String(a))
          ).join(' ');
          var line = document.createElement('div');
          line.textContent = msg;
          line.style.borderBottom = '1px solid #333';
          logDiv.appendChild(line);
          logDiv.scrollTop = logDiv.scrollHeight;
        }

        var oldLog = console.log;
        var oldErr = console.error;
        var oldWarn = console.warn;
        console.log = function () { oldLog.apply(console, arguments); printLog('[LOG]', arguments); };
        console.error = function () { oldErr.apply(console, arguments); printLog('[ERR]', arguments); };
        console.warn = function () { oldWarn.apply(console, arguments); printLog('[WRN]', arguments); };

        window.onerror = function (msg, url, line) {
          printLog('[EXCEPTION]', [msg, url, line]);
        };
      })();

    // Bridge script injected by Go Altium Viewer
    window.addEventListener('message', function (e) {
      // Log all messages to see what's happening
      console.log("Msg received:", e.data);
      if (e.data && e.data.message === 'loadWidget') {
        console.log("Bridge: Received loadWidget", e.data);
        var attempts = 0;
        var ii = setInterval(function () {
          var appExists = !!window.__APP__;
          var eventsExists = appExists && !!window.__APP__.parentEvents;
          console.log("Bridge check " + attempts + ": __APP__=" + appExists + ", parentEvents=" + eventsExists);

          if (eventsExists) {
            clearInterval(ii);
            console.log("Bridge: EVENTS DETECTED. Waiting 1s to ensure listener is matched...");
            setTimeout(function () {
              console.log("Bridge: Emitting app:load via postMessage to window");
              // Clone data and change message type
              var evtData = Object.assign({}, e.data);
              evtData.message = 'app:load';
              window.postMessage(evtData, '*');
              console.log("Bridge: PostMessage done.");
            }, 1000);
          }
          attempts++;
          if (attempts > 100) { // 5 seconds
            clearInterval(ii);
            console.error("Bridge: Timeout waiting for parentEvents");
          }
        }, 50);
      }
    });
  </script>
  <div id="viewer-app"></div>
  <script src="js/vue.js?3.2.33"></script>
</body>

</html>